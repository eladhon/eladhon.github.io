---
import ThemeToggle from "./ThemeToggle.astro";

const { pathname } = Astro.url;
const isHome = pathname === "/";

const navItems = [
    { name: "About", href: "#about" },
    { name: "Skills", href: "#skills" },
    // { name: "Experience", href: "#experience" },
    { name: "Education", href: "#education" },
    { name: "Projects", href: "#projects" },
];
---

<nav
    class="fixed top-0 left-0 right-0 z-50 flex justify-center pt-6 px-6 pointer-events-none"
>
    <div
        class="pointer-events-auto flex items-center justify-start sm:justify-center gap-1 rounded-full bg-white/80 dark:bg-dark-surface/80 border border-gray-200 dark:border-dark-border px-3 py-2 backdrop-blur-md shadow-lg shadow-black/5 dark:shadow-black/20 max-w-[90vw] overflow-x-auto no-scrollbar"
    >
        <a
            href="/"
            class="px-4 py-2 rounded-full text-sm font-bold transition-all flex items-center text-primary-600 dark:text-primary-400 hover:bg-primary-500/10 shrink-0"
            aria-label="Home"
        >
            EE
        </a>
        <div class="w-px h-6 bg-gray-200 dark:bg-dark-border mx-1 shrink-0">
        </div>
        {
            navItems.map((item) => (
                <a
                    href={isHome ? item.href : `/${item.href}`}
                    class="nav-link relative px-4 py-2 rounded-full text-sm font-medium transition-all text-gray-500 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-white dark:hover:bg-white/5 shrink-0 group"
                    data-href={item.href}
                >
                    {item.name}
                    <span class="absolute bottom-1.5 left-3 right-3 h-0.5 bg-primary-600 dark:bg-primary-400 scale-x-0 transition-transform origin-center group-[.active]:scale-x-100 rounded-full" />
                </a>
            ))
        }
        <div class="w-px h-6 bg-gray-200 dark:bg-dark-border mx-1 shrink-0">
        </div>
        <div class="shrink-0">
            <ThemeToggle />
        </div>
    </div>
</nav>

<style>
    .no-scrollbar::-webkit-scrollbar {
        display: none;
    }
    .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
</style>

<script>
    const navLinks = document.querySelectorAll(".nav-link");

    // Function to set active link based on current section
    const setActiveLink = () => {
        const sections = document.querySelectorAll("section");
        let currentSection = "";

        sections.forEach((section) => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            if (window.scrollY >= sectionTop - 150) {
                currentSection = section.getAttribute("id") || "";
            }
        });

        // Special handling for being at the bottom of the page
        if (
            window.innerHeight + window.scrollY >=
            document.body.offsetHeight - 50
        ) {
            // Find the last section
            const lastSection = sections[sections.length - 1];
            if (lastSection) {
                currentSection = lastSection.getAttribute("id") || "";
            }
        }

        navLinks.forEach((link) => {
            link.classList.remove("active");
            if (
                link.getAttribute("data-href") === `#${currentSection}` &&
                window.location.pathname === "/"
            ) {
                link.classList.add("active");
            }
        });
    };

    // Initial check
    if (window.location.pathname === "/") {
        window.addEventListener("scroll", setActiveLink);
        setActiveLink();
    } else {
        // If not home, check if we are on a page that matches a nav item (e.g. /projects)
        // For now, this navbar pattern relies on sections on home.
        // If on /projects, maybe highlight nothing or highlight "Projects" if desired?
        // User asked for "indicator when selected".
        // Let's assume if on /projects, we highlight "Projects"
        navLinks.forEach((link) => {
            if (
                link.getAttribute("href") === "/#projects" &&
                window.location.pathname.includes("projects")
            ) {
                link.classList.add("active");
            }
        });
    }
</script>
